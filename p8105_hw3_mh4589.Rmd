---
title: "p8105_hw3_mh4589"
author: "My An Huynh"
date: "2024-10-04"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)
data("ny_noaa")
class(ny_noaa)
```


```{r}
ny_noaa_df <- ny_noaa |> 
  separate(date, into = c("year", "month", "day"), sep = "-")

snow_mode =
  ny_noaa_df |> 
  count(snow, name = "frequency") |> 
  arrange(desc(frequency)) |> 
  slice(1)
```

The dataset NY NOAA provies information on temperature, snowfall, snow depth and precipitation everyday starting from 1981 at different weather stations in NY. Most of the data values came back 

There are `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns. 
The most common snowfall is 0. This is because snow is commonly observed on certain days during winter months, but not the rest of the year. 
Make a two-panel plot showing the average max temperature in January and in July in each station across years. 

```{r}
ny_noaa_df |> 
  drop_na(tmax, tmin) |> 
  filter(month == c("01", "07")) |>
  group_by(id, year) |> 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin),
    tmax = tmax/10,
    tmin = tmin/10,
    mean_tmax = mean(tmax, na.rm = TRUE)
  ) |> 
  ggplot(aes(x = id, y = mean_tmax, color = year)) + 
  geom_point(aes(group = year), alpha = 0.5) +
  facet_grid(~month) +
  labs(
    title = "Mean Maximum Temperature Across Stations in January and July",
    x = "Station",
    y = "Mean Maximum Temperature (C)"
) +
  theme_minimal()
```



Disrtibution of snow by year 
```{r}
ny_noaa_df |> 
  filter(snow > 0, snow < 100) |> 
  ggplot(aes(x = snow, fill = year)) +
  geom_density()
  
  
```

## Problem 2

Load, tidy, merge and organize the acceleration and demographic datasets.
```{r}
accel_df =
  read_csv("data/nhanes_accel.csv") |> 
  janitor::clean_names()

covar_df = 
  read_csv("data/nhanes_covar.csv", skip = 4) |> 
  janitor::clean_names() |> 
  mutate(
    sex = factor(sex),
    education = factor(education)
  )

nhanes_df = 
  left_join(covar_df, accel_df, by = "seqn") |> 
  filter(age > 21) |> 
  drop_na(education, bmi, age, sex)

  
```

Created a reader-friendly table using `kable()` showing teh number of men and women in each education category, and created a boxplot showing the dsitribution of age for men and women across each education category. For the table, category 3 in education has the most participants. There are more male participants whose education is in category 2 compared to female. 

```{r}
nhanes_df |> 
  group_by(education, sex) |> 
  summarize(
    count = n()
  ) |> 
  pivot_wider(
    names_from = education,
    values_from = count
  ) |> 
  knitr::kable(
    caption = "Number of men and women in each education category"
  ) 

nhanes_df |> 
  ggplot(aes(x = education, y = age, fill = sex)) + 
  geom_boxplot() +
  labs(
    title = "Distribution of Age by Sex and Education",
    x = "Education Category",
    y = "Age"
  ) +
  theme_minimal()
```

Created a new `total_activity` variable that aggregates activity level across 1440 minutes for each participant. Made a plot of total activity against age and included a trend line. The overall trend indicates that there is less activity as age increases for all participants, male and female and across 3 education groups. For education groups 

```{r}
nhanes_df |> 
  mutate(
    total_activity = rowSums(across(min1:min1440), na.rm = TRUE)
  ) |> 
  ggplot(aes(x = age, y = total_activity, color = sex))+
  geom_point(alpha = 0.5)+
  geom_smooth(se = TRUE) +
  facet_grid(~education) + 
  labs(
    title = "Total Activity vs Age across Sex and Education Level",
    x = "Age (years)",
    y = "Total Activity"
  )

```

## Problem 3

Load the zip files and joined 4 datasets together. 
```{r}
jan_20_df = 
  read_csv("data/Jan 2020 Citi.csv") |>
  janitor::clean_names() |> 
  mutate(
    month = "January",
    year = "2020"
  )

jan_24_df = 
  read_csv("data/Jan 2024 Citi.csv") |> 
  janitor::clean_names() |> 
   mutate(
    month = "January",
    year = "2024"
  )


jul_20_df = 
  read_csv("data/July 2020 Citi.csv") |> 
  janitor::clean_names() |> 
   mutate(
    month = "July",
    year = "2020"
  )


jul_24_df = 
  read_csv("data/July 2024 Citi.csv") |> 
  janitor::clean_names() |> 
   mutate(
    month = "July",
    year = "2024"
  )

citi_df = 
  bind_rows(jan_20_df, jan_24_df, jul_20_df, jul_24_df)
  
```

The joined dataset includes information on 1% of all rides with a total duration less than 4 hours in each of four months (January 2020, July 2020, January 2024 and July 2024). The variables in this dataset are ride IDs, types of ride, days of the week that the bikes were rented on, duration of rental (in minutes), pickup and drop off locations, and types of membership (Citi Bike member or casual). There are `r ncol(citi_df)` variables and `r nrow(citi_df)` observations. 


Create a reader-friendly table showing the total number of rides in each combination of year and month separating casual riders and Citi Bike members. The results show that there are more bikes being rented in July compared to January across both 2020 and 2024. There are more bikes being rented in 2024 compared to 2020. Overall, there are more members renting CitiBike than non-members (casual). 
```{r}
citi_df |> 
  group_by(month, year, member_casual) |> 
  summarize(
    count = n()
  ) |> 
  pivot_wider(
    names_from = member_casual,
    values_from = count
  ) |> 
  knitr::kable()
```

Crete a table showing 5 most popular starting stations in July 2024. 

```{r}
  citi_df |> 
  filter(month == "July", year == "2024", .keep_all = TRUE) |> 
  group_by(start_station_name) |> 
  summarize(numer_of_rides = n()) |> 
  mutate(
    start_station_rank = min_rank(desc(numer_of_rides))
  ) |> 
  arrange(start_station_rank) |> 
  head(5)
```

Make a plot that investigates the effects of day of the week, month, and year on median ride duration.

```{r}
citi_df |> 
  group_by(weekdays, month, year) |> 
  summarize(
    median_duration = median(duration, ra.rm = TRUE)
  ) |> 
  ggplot(aes(x = weekdays, y = median_duration, fill = weekdays)) +
  geom_bar(stat = "identity") +
  facet_grid(year ~ month)
```

